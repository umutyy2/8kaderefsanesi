<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Sekiz Kader v17.0 - Nihai Efsane</title>
<style>
  html, body { height: 100%; margin: 0; overflow: hidden; background: #010409; color: #fff; font-family: 'Georgia', serif; user-select: none; -webkit-user-select: none; touch-action: none; }
  .wrap { display: flex; align-items: center; justify-content: center; height: 100%; flex-direction: column; position: relative; }
  .stats-bar { position: absolute; top: 15px; width: 90%; display: flex; justify-content: space-between; align-items: center; z-index: 100; background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 10px; border: 1px solid #30363d; }
  .hp-box { width: 120px; height: 12px; background: #21262d; border-radius: 6px; border: 1px solid #30363d; position: relative; }
  #hpFill { height: 100%; background: linear-gradient(90deg, #238636, #2ea043); width: 100%; transition: width 0.4s; }
  .bigbtn { width: 94vw; height: 75vh; border-radius: 40px; background: radial-gradient(circle at center, #161b22 0%, #010409 100%); display: flex; align-items: center; justify-content: center; font-size: 1.6rem; text-align: center; border: 5px solid #30363d; padding: 35px; box-sizing: border-box; box-shadow: 0 0 100px rgba(0,0,0,1); transition: all 0.2s; }
  .ui-label { position: absolute; bottom: 20px; font-size: 0.8rem; color: #8b949e; letter-spacing: 1px; }
  .settings-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(1,4,9,0.95); display: none; z-index: 200; flex-direction: column; align-items: center; justify-content: center; }
</style>
</head>
<body>

<div class="wrap">
  <div class="stats-bar">
    <div id="charInfo">Kader Yolcusu</div>
    <div class="hp-box"><div id="hpFill"></div></div>
  </div>
  
  <div id="big" class="bigbtn">SEKİZ KADER EFSANESİ<br><br>OYUNU BAŞLATMAK İÇİN ÇİFT TIKLA</div>
  
  <div class="ui-label" id="hint">YUKARI/AŞAĞI: GEZİN | ÇİFT TIKLA: SEÇ</div>
</div>

<script>
const synth = window.speechSynthesis;
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let voices = [];
let player = { hp: 100, char: null, score: { pwr:0, sac:0, kno:0, bet:0 } };
let mode = 'main_menu'; // main_menu, char_select, story, combat, end
let menuIdx = 0;
const menus = ["MACERAYA BAŞLA", "KAHRAMAN SEÇ", "SES AYARLARI", "DESTAN HAKKINDA"];
let charIdx = 0;
const heroes = [
  { n: "Aran", d: "Savaşçı. Kalkanı ile hasarı siper eder.", hp: 120, skill: "Demir Kalkan" },
  { n: "Sera", d: "Bilge. Ritüelleri ve kütüphane sırlarını bilir.", hp: 80, skill: "Kadim Rün" },
  { n: "Brom", d: "Rahip. Kutsal ışıkla grubu iyileştirir.", hp: 100, skill: "Şifa Işığı" },
  { n: "Lira", d: "Gölge. Hızlıdır ve kritik vuruşlar yapar.", hp: 90, skill: "Gölge Hançeri" }
];

let step = 0;
// STORY.HTML'DEN ALINAN KESİN BÖLÜMLER
const chapters = [
  { id:1, t:"Bölüm I: Giriş Salonları", d:"Taş kafes düşüyor! Aran kükredi: 'Kalkanımın arkasına!'. Sağ: Siper Ol. Sol: Kaç.", s:'sac' },
  { id:2, t:"Bölüm II: Aynalar Koridoru", d:"Karanlık yansıma fısıldıyor: 'Güç ellerinde, sadece kabul et.' Sağ: Gücü Al. Sol: Reddet.", s:'bet' },
  { id:3, t:"Bölüm III: Ruhların Kütüphanesi", d:"Kitaplar fısıldıyor. Sera: 'Ritüeli öğrenmek için bir anımı feda etmeliyim.' Sağ: Anıyı Ver. Sol: Geç.", s:'kno' },
  { id:4, t:"Bölüm IV: Sırlı Bahçe", d:"Zehirli sarmaşıklar yolu kapattı! Brom meyveye dokundu. Sağ: Savaş. Sol: Geri Çekil.", s:'pwr' },
  { id:5, t:"Bölüm V: Ateş Kesiti", d:"Lira: 'Arzuların alevi kalbimi yakıyor!' Kristal lavın içinde. Sağ: Kristali Al. Sol: Adaleti Seç.", s:'pwr' },
  { id:6, t:"Bölüm VI: Gölgeler Labirenti", d:"En derin korkunla yüzleşiyorsun. Kaçacak yer yok. Sağ: Korkunla Savaş. Sol: Teslim Ol.", s:'sac' },
  { id:7, t:"Bölüm VII: Taç Odası", d:"Kaderin tacı önünde duruyor. Sağ: Tacı Tak. Sol: Tacı Kır." }
];

function speak(text) {
  synth.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'tr-TR'; u.rate = 1.1; u.pitch = 1;
  synth.speak(u);
  document.getElementById('big').innerText = text;
}

function handleAction(act) {
  if (audioCtx.state === 'suspended') audioCtx.resume();

  if (mode === 'main_menu') {
    if (act === 'up') { menuIdx = (menuIdx - 1 + menus.length) % menus.length; speak(menus[menuIdx]); }
    else if (act === 'down') { menuIdx = (menuIdx + 1) % menus.length; speak(menus[menuIdx]); }
    else if (act === 'doubletap') {
      if (menuIdx === 0) { if(!player.char) player.char = heroes[0]; mode = 'story'; nextStep(); }
      else if (menuIdx === 1) { mode = 'char_select'; speak(heroes[charIdx].n + ": " + heroes[charIdx].d); }
    }
  } 
  else if (mode === 'char_select') {
    if (act === 'right' || act === 'left') { charIdx = (charIdx + (act==='right'?1:-1) + heroes.length) % heroes.length; speak(heroes[charIdx].n + ": " + heroes[charIdx].d); }
    else if (act === 'doubletap') { player.char = heroes[charIdx]; player.hp = player.char.hp; mode = 'main_menu'; speak(player.char.n + " seçildi. Ana menüye dönüldü."); updateStats(); }
  }
  else if (mode === 'story') {
    const c = chapters[step-1];
    if (act === 'right') { player.score[c.s] += 2; } 
    else if (act === 'left') { player.score.bet += 1; }
    
    if (step >= chapters.length) calculateFinalEnding(act === 'right');
    else nextStep();
  }
}

function nextStep() {
  const c = chapters[step];
  step++;
  speak(c.t + ". " + c.d);
  document.getElementById('charInfo').innerText = "Bölüm " + c.id + " / 7";
}

function updateStats() {
  document.getElementById('hpFill').style.width = (player.hp / (player.char ? player.char.hp : 100) * 100) + "%";
  if(player.char) document.getElementById('charInfo').innerText = player.char.n + " | HP: " + player.hp;
}

function calculateFinalEnding(tookCrown) {
  mode = 'end';
  const s = player.score;
  let res = "";
  if(tookCrown) {
    if(s.bet > 3) res = "Son 1: Taç’ın Karanlık Hükmü. Zindanın yeni efendisi sensin.";
    else if(s.pwr > 3) res = "Son 4: Güç Dengesi. Sert bir adalet dünyaya hakim oldu.";
    else res = "Son 5: Taç'ın Hürriyeti. Dünya gölgelerin eline geçti.";
  } else {
    if(s.sac > 3) res = "Son 2: Kırılış ve Yok Oluş. Zindan çöktü, dünya özgür.";
    else if(s.kno > 3) res = "Son 3: Taç'ı Saklamak. Lira ebedi nöbeti tutuyor.";
    else res = "Son 8: Sonsuz Döngü. Macera yeniden başlıyor...";
  }
  speak(res);
  setTimeout(() => location.reload(), 15000);
}

// TOUCH SENSOR
let startX, startY, lastTap = 0;
document.addEventListener('touchstart', e => { startX = e.touches[0].clientX; startY = e.touches[0].clientY; });
document.addEventListener('touchend', e => {
  const diffX = e.changedTouches[0].clientX - startX;
  const diffY = e.changedTouches[0].clientY - startY;
  const now = Date.now();
  
  if (now - lastTap < 300) handleAction('doubletap');
  else if (Math.abs(diffX) > 50) handleAction(diffX > 0 ? 'right' : 'left');
  else if (Math.abs(diffY) > 50) handleAction(diffY > 0 ? 'down' : 'up');
  
  lastTap = now;
});
window.speechSynthesis.onvoiceschanged = () => { voices = window.speechSynthesis.getVoices(); };
</script>
</body>
</html>
