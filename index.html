<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Sekiz Kader v15.0 - Nihai Restorasyon</title>
<style>
  html, body { height: 100%; margin: 0; overflow: hidden; background: #010409; color: #fff; font-family: 'Georgia', serif; user-select: none; }
  .wrap { display: flex; align-items: center; justify-content: center; height: 100%; flex-direction: column; }
  .bigbtn { width: 92vw; height: 75vh; border-radius: 40px; background: radial-gradient(circle, #1a202c 0%, #010409 100%); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; text-align: center; border: 4px solid #30363d; padding: 30px; box-sizing: border-box; box-shadow: 0 0 50px rgba(0,0,0,1); }
  .menu-ui { position: absolute; top: 10px; font-size: 0.8rem; color: #8b949e; }
</style>
</head>
<body>
<div class="wrap">
  <div id="ui" class="menu-ui">Mod: Giriş | Dokun ve Başlat</div>
  <div id="big" class="bigbtn">SEKİZ KADER EFSANESİ<br>V15.0<br><br>BAŞLATMAK İÇİN DOKUN</div>
</div>

<script>
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const synth = window.speechSynthesis;
let voices = [];
let config = { rate: 1.1, voiceIdx: 0 };
let player = { hp: 100, score: { pwr:0, sac:0, kno:0, bet:0 } };
let mode = 'intro'; 
let step = 0;

function speak(text) {
  synth.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'tr-TR';
  u.rate = config.rate;
  if(voices[config.voiceIdx]) u.voice = voices[config.voiceIdx];
  synth.speak(u);
  document.getElementById('big').innerText = text;
}

// BÖLÜM VERİLERİ (Story.html'den Kesin Veriler)
const story = [
  { id: 1, n: "Giriş Salonları", d: "Aran: 'Herkes kalkanımın arkasına!' diye bağırdı. Sağ: Aran siper olsun. Sol: Herkes kaçsın.", s: 'sac' },
  { id: 2, n: "Aynalar Koridoru", d: "Sera yansımasıyla konuşuyor: 'Güç senin olabilir.' Sağ: Gücü al. Sol: Reddet.", s: 'bet' },
  { id: 3, n: "Ruhların Kütüphanesi", d: "Kitaplar fısıldıyor. Sera: 'Ritüel için bir anı feda etmeliyim.' Sağ: Hafızayı ver (Bilgi al). Sol: Geç.", s: 'kno' },
  { id: 4, n: "Sırlı Bahçe", d: "Brom meyveyi kopardı! Sarmaşıklar saldırdı. Sağ: Lira'nın yolundan git. Sol: Savaş.", s: 'pwr' },
  { id: 5, n: "Ateş Kesiti", d: "Lira: 'Bu sıcaklık aklımı alıyor!' dedi. Kristal lavda. Sağ: Kristali al. Sol: Adaleti koru.", s: 'pwr' },
  { id: 6, n: "Gölgeler Labirenti", d: "En derin korkunla yüzleşiyorsun. Sağ: Korkunla savaş. Sol: Geri çekil.", s: 'sac' },
  { id: 7, n: "Final: Taç Odası", d: "Taç önünde parlıyor. Kader anı. Sağ: Tacı Tak. Sol: Tacı Kır." }
];

function handleInput(act) {
  if (mode === 'intro') {
    mode = 'game';
    runChapter();
  } else if (mode === 'game') {
    const c = story[step];
    if (act === 'R') { player.score[c.s] += 2; } 
    else if (act === 'L') { player.score.bet += 1; }
    
    step++;
    if (step < story.length) runChapter();
    else calculateEnding(act === 'R');
  }
}

function runChapter() {
  const c = story[step];
  document.getElementById('ui').innerText = "Bölüm: " + c.id + " / 7";
  speak(c.n + ". " + c.d);
}

function calculateEnding(tookCrown) {
  mode = 'end';
  const s = player.score;
  let final = "";
  if(tookCrown) {
    if(s.bet > 3) final = "Son 1: Taç’ın Karanlık Hükmü. Zindan Taç ile birleşti.";
    else if(s.pwr > 3) final = "Son 4: Güç Dengesi. Dünya sert bir adaletle yönetiliyor.";
    else final = "Son 5: Taç'ın Hürriyeti. Gölgeler dünyayı istila etti.";
  } else {
    if(s.sac > 3) final = "Son 2: Kırılış ve Yok Oluş. Zindan çöktü, dünya kurtuldu.";
    else if(s.kno > 3) final = "Son 3: Taç'ı Saklamak. Lira ebedi nöbeti seçti.";
    else final = "Son 8: Sonsuz Döngü. Macera yeniden başlıyor.";
  }
  speak(final);
  setTimeout(() => location.reload(), 12000);
}

// Touch & Swipe Logic
let tX, tY;
document.getElementById('big').addEventListener('touchstart', e => { 
  tX = e.touches[0].clientX; 
  tY = e.touches[0].clientY; 
  if(audioCtx.state === 'suspended') audioCtx.resume();
});

document.getElementById('big').addEventListener('touchend', e => {
  const dX = e.changedTouches[0].clientX - tX;
  const dY = e.changedTouches[0].clientY - tY;
  if (Math.abs(dX) > 40) handleInput(dX > 0 ? 'R' : 'L');
  else if (Math.abs(dY) < 10) handleInput('TAP');
});

window.speechSynthesis.onvoiceschanged = () => { voices = window.speechSynthesis.getVoices(); };
</script>
</body>
</html>
