<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Sekiz Kader v16.0 - Efsanevi İskelet</title>
<style>
  html, body { height: 100%; margin: 0; overflow: hidden; background: #010409; color: #fff; font-family: 'Georgia', serif; user-select: none; }
  .wrap { display: flex; align-items: center; justify-content: center; height: 100%; flex-direction: column; position: relative; }
  .stats { position: absolute; top: 20px; width: 90%; display: flex; justify-content: space-between; font-size: 0.9rem; color: #8b949e; z-index: 10; }
  .hp-bar { width: 100px; height: 10px; background: #30363d; border-radius: 5px; overflow: hidden; }
  .hp-fill { height: 100%; background: #238636; width: 100%; transition: width 0.3s; }
  .bigbtn { width: 92vw; height: 70vh; border-radius: 40px; background: radial-gradient(circle, #161b22 0%, #010409 100%); display: flex; align-items: center; justify-content: center; font-size: 1.6rem; text-align: center; border: 4px solid #30363d; padding: 30px; box-sizing: border-box; box-shadow: 0 0 80px rgba(0,0,0,1); cursor: pointer; transition: transform 0.1s; }
  .bigbtn:active { transform: scale(0.98); }
  .menu-hint { margin-top: 20px; font-size: 0.8rem; color: #484f58; animation: pulse 2s infinite; }
  @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
</style>
</head>
<body>
<div class="wrap">
  <div class="stats">
    <div id="charName">Kader Yolcusu</div>
    <div class="hp-bar"><div id="hpFill" class="hp-fill"></div></div>
  </div>
  <div id="big" class="bigbtn">SEKİZ KADER<br>ANA MENÜ<br><br>BAŞLAMAK İÇİN ÇİFT TIKLA</div>
  <div class="menu-hint">Yukarı/Aşağı: Menüde Gezin | Çift Tık: Seç</div>
</div>

<script>
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const synth = window.speechSynthesis;
let voices = [];
let conf = { rate: 1.1, pitch: 1 };
let player = { hp: 100, char: null, score: { pwr:0, sac:0, kno:0, bet:0 } };
let mode = 'menu'; // menu, char_select, game, settings, end
let menuIdx = 0;
const menuItems = ["OYUNA BAŞLA", "KARAKTER SEÇ", "AYARLAR", "YAPIMCILAR"];
let charIdx = 0;
const chars = [
  { n: "Aran", d: "Savaşçı. Kalkanı ile hasarı engeller.", skill: "Kalkan Dağı", hp: 120 },
  { n: "Sera", d: "Bilge. Ritüelleri ve gizli yolları bilir.", skill: "Kadim Rün", hp: 80 },
  { n: "Brom", d: "Rahip. Kutsal ışıkla can tazeler.", skill: "Şifa Nuru", hp: 100 },
  { n: "Lira", d: "Gölge. Sinsi ve hızlı hareket eder.", skill: "Gölge Adımı", hp: 90 }
];
let step = 0;
const story = [
  { t: "Bölüm 1: Giriş Salonları", d: "Taş kafes düşüyor! Sağ: Siper ol. Sol: Kaç.", s: 'sac' },
  { t: "Bölüm 2: Aynalar Koridoru", d: "Karanlık yansıma fısıldıyor: 'Gücü al'. Sağ: Kabul et. Sol: Reddet.", s: 'bet' },
  { t: "Bölüm 3: Ruhların Kütüphanesi", d: "Sera: 'Bilgi için bir anı feda etmeliyim.' Sağ: Hafızayı feda et. Sol: Geç.", s: 'kno' },
  { t: "Bölüm 4: Sırlı Bahçe", d: "Zehirli sarmaşıklar yolu kapattı! Sağ: Savaş. Sol: Kaç.", s: 'pwr' },
  { t: "Bölüm 5: Ateş Kesiti", d: "Lavların ortasında parlayan kristal... Sağ: Kristali al. Sol: Adaleti seç.", s: 'pwr' },
  { t: "Bölüm 6: Gölgeler Labirenti", d: "Korkularınız canlanıyor. Sağ: Korkunla yüzleş. Sol: Kaç.", s: 'sac' },
  { t: "Bölüm 7: Final: Taç Odası", d: "Taç önünde. Sağ: Tacı Tak. Sol: Tacı Kır." }
];

function speak(t) {
  synth.cancel(); const u = new SpeechSynthesisUtterance(t);
  u.lang = 'tr-TR'; u.rate = conf.rate; u.pitch = conf.pitch;
  synth.speak(u); document.getElementById('big').innerText = t;
}

function updateUI() {
  document.getElementById('hpFill').style.width = player.hp + "%";
  if(player.char) document.getElementById('charName').innerText = player.char.n + " | HP: " + player.hp;
}

function handleInput(act) {
  if(audioCtx.state === 'suspended') audioCtx.resume();
  
  if(mode === 'menu') {
    if(act === 'up') { menuIdx = (menuIdx - 1 + menuItems.length) % menuItems.length; speak(menuItems[menuIdx]); }
    else if(act === 'down') { menuIdx = (menuIdx + 1) % menuItems.length; speak(menuItems[menuIdx]); }
    else if(act === 'tap' || act === 'doubletap') {
      if(menuIdx === 0) { if(!player.char) player.char = chars[0]; mode = 'game'; nextStep(); }
      else if(menuIdx === 1) { mode = 'char_select'; speak(chars[charIdx].n + ". " + chars[charIdx].d); }
      else if(menuIdx === 2) { speak("Ayarlar: Hız ve Ses perdesi."); }
    }
  } 
  else if(mode === 'char_select') {
    if(act === 'right' || act === 'left') { charIdx = (charIdx + (act==='right'?1:-1) + chars.length)%chars.length; speak(chars[charIdx].n + ". " + chars[charIdx].d); }
    else if(act === 'tap' || act === 'doubletap') { player.char = chars[charIdx]; player.hp = player.char.hp; mode = 'menu'; speak(player.char.n + " seçildi. Ana menüye dönüldü."); updateUI(); }
  }
  else if(mode === 'game') {
    const c = story[step-1];
    if(act === 'R') { player.score[c.s] += 2; } 
    else if(act === 'L') { player.score.bet += 1; }
    
    if(step >= story.length) calculateEnding(act === 'R');
    else nextStep();
  }
}

function nextStep() {
  const c = story[step]; step++;
  speak(c.t + ". " + c.d);
}

function calculateEnding(tookCrown) {
  mode = 'end';
  const s = player.score; let f = "";
  if(tookCrown) {
    if(s.bet > 3) f = "Son 1: Taç’ın Karanlık Hükmü.";
    else if(s.pwr > 3) f = "Son 4: Güç Dengesi.";
    else f = "Son 5: Taç'ın Hürriyeti.";
  } else {
    if(s.sac > 3) f = "Son 2: Kırılış ve Yok Oluş.";
    else if(s.kno > 3) f = "Son 3: Taç'ı Saklamak.";
    else f = "Son 8: Sonsuz Döngü.";
  }
  speak(f + " Oyun bitti.");
  setTimeout(()=>location.reload(), 15000);
}

// Touch Engine
let tX, tY, lastTap = 0;
document.getElementById('big').addEventListener('touchstart', e => { tX = e.touches[0].clientX; tY = e.touches[0].clientY; });
document.getElementById('big').addEventListener('touchend', e => {
  const dX = e.changedTouches[0].clientX - tX;
  const dY = e.changedTouches[0].clientY - tY;
  const now = Date.now();
  if(now - lastTap < 300) handleInput('doubletap');
  else if(Math.abs(dX) > 40) handleInput(dX > 0 ? 'R' : 'L');
  else if(Math.abs(dY) > 40) handleInput(dY > 0 ? 'down' : 'up');
  else handleInput('tap');
  lastTap = now;
});

window.onload = () => { voices = window.speechSynthesis.getVoices(); };
</script>
</body>
</html>
